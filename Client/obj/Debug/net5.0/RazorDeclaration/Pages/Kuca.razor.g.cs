// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace ERacuniNovi.Client.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using ERacuniNovi.Client;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using ERacuniNovi.Client.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using Grpc;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\Proye\Desktop\ERacuni\Client\_Imports.razor"
using MatBlazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Proye\Desktop\ERacuni\Client\Pages\Kuca.razor"
using ERacuniNovi.Shared.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Proye\Desktop\ERacuni\Client\Pages\Kuca.razor"
using ERacuniNovi.Shared.Konvertor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Proye\Desktop\ERacuni\Client\Pages\Kuca.razor"
using Radzen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Proye\Desktop\ERacuni\Client\Pages\Kuca.razor"
using Grpc.Core;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Proye\Desktop\ERacuni\Client\Pages\Kuca.razor"
using System.Diagnostics;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Proye\Desktop\ERacuni\Client\Pages\Kuca.razor"
using Radzen.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Proye\Desktop\ERacuni\Client\Pages\Kuca.razor"
using BillsNamespace;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Proye\Desktop\ERacuni\Client\Pages\Kuca.razor"
using ERacuniNovi.Client.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\Proye\Desktop\ERacuni\Client\Pages\Kuca.razor"
using Blazored.FluentValidation;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/kuca")]
    public partial class Kuca : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 244 "C:\Users\Proye\Desktop\ERacuni\Client\Pages\Kuca.razor"
       

    private List<Bill> ListaRacuna = new List<Bill>();
    private Bill RacunZaSlanje = new Bill();
    private Bill PrimljeniRacun = new Bill();
    private Bill CancelEditRacun = new Bill();
    private int IDzaBrisanje;
    private bool showMatExpansionPanel;
    private bool snackBarIsOpen;
    private bool snackBarIsOpenChanged;
    private bool snackBarIsOpenDeleted;
    private bool IsMatDialogOpen;
    private double Zarada { get; set; } = 0;
    private Stopwatch sw = new Stopwatch();
    RadzenGrid<Bill> RadzenGrid;
    DateTime defaultDateTime = new DateTime(0001, 1, 1, 0, 0, 0);

    protected override async Task OnInitializedAsync()
    {
        var serverStream = ServiceBill.GetAllKucaBill(new EmptyMsg());
        sw.Start();
        await foreach (var racun in serverStream.ResponseStream.ReadAllAsync())
        {
            ListaRacuna.Add(ServiceConvert.ConvertCeoRacun(racun));
            ListaRacuna = ListaRacuna.OrderByDescending(b => (b.DatumSlanja.Date, b.DatumSlanja.TimeOfDay)).ToList(); //sortira po desc datum slanja, novi ubaceni su na vrh
            if (sw.ElapsedMilliseconds == 5)
            {
                StateHasChanged();
            }
        }
        sw.Stop();
    }

    #region Dodavanje Racuna
    public async Task SubmitRacun()
    {
        RacunZaSlanje.Naziv ??= string.Empty;
        RacunZaSlanje.AdresaMusterije ??= string.Empty;

        var request = ServiceConvert.ConvertKuca(RacunZaSlanje);

        var response = await ServiceBill.AddBillKucaAsync(request);
        if (response.IsUpisan)
        {
            PrimljeniRacun = ServiceConvert.ConvertCeoRacun(response.BillResponse);

            ListaRacuna.Add(PrimljeniRacun);
            ListaRacuna = ListaRacuna.OrderByDescending(b => (b.DatumSlanja.Date, b.DatumSlanja.TimeOfDay)).ToList(); //sortira po desc datum slanja, novi ubaceni su na vrh
            showMatExpansionPanel = false;
            RacunZaSlanje = new Bill();
        }
        else
        {
            snackBarIsOpen = true;
        }

        StateHasChanged();
        //await InvokeAsync(RadzenGrid.Reload);

    }
    public void CancelSubmitRacun()
    {
        RacunZaSlanje = new Bill();
        showMatExpansionPanel = false;
        StateHasChanged();
    }
    #endregion

    #region Editovanje Racuna u Radzenu
    public void EditRow(Bill bill)
    {
        CancelEditRacun = bill.ShallowCopy(); //ovo je racun koji je bio pre izmene -- original
        RadzenGrid.EditRow(bill);
    }
    public async void CancelEdit(Bill bill)
    {
        RadzenGrid.CancelEditRow(bill); //bill je onaj koji se menja, njega treba da odjebemo
        ListaRacuna.Where(b => b.ID == CancelEditRacun.ID).FirstOrDefault().Naziv = CancelEditRacun.Naziv;
        ListaRacuna.Where(b => b.ID == CancelEditRacun.ID).FirstOrDefault().AdresaMusterije = CancelEditRacun.AdresaMusterije;
        ListaRacuna.Where(b => b.ID == CancelEditRacun.ID).FirstOrDefault().DatumSlanja = CancelEditRacun.DatumSlanja;
        ListaRacuna.Where(b => b.ID == CancelEditRacun.ID).FirstOrDefault().NabavnaCena = CancelEditRacun.NabavnaCena;
        ListaRacuna.Where(b => b.ID == CancelEditRacun.ID).FirstOrDefault().ProdajnaCena = CancelEditRacun.ProdajnaCena;
        ListaRacuna.Where(b => b.ID == CancelEditRacun.ID).FirstOrDefault().Rashod = CancelEditRacun.Rashod;

        StateHasChanged();
        await InvokeAsync(RadzenGrid.Reload);


    }
    public async void SaveRow(Bill bill)
    {

        var response = await ServiceBill.ChangeBillKucaAsync(ServiceConvert.ConvertKuca(bill));

        if (response.IsUpisan)
        {
            await RadzenGrid.UpdateRow(bill);
            ListaRacuna = ListaRacuna.OrderByDescending(b => (b.DatumSlanja.Date, b.DatumSlanja.TimeOfDay)).ToList(); //sortira po desc datum slanja, novi ubaceni su na vrh
            StateHasChanged();

        }
        else //ovo se nikad nece desiti jer ce uvek da ga nadje po Barcode-u u bazi i da ga izmeni,nema sansi da ga ne izmeni u bazi
        {
            snackBarIsOpenChanged = true;
            RadzenGrid.CancelEditRow(bill);
        }
        await InvokeAsync(RadzenGrid.Reload);

    }
    #endregion

    #region Brisanje Racuna u Radzenu

    public void CheckForDelete(int ID)
    {
        IDzaBrisanje = ID;
        IsMatDialogOpen = true;
        StateHasChanged();
    }

    public async void DeleteBill(int ID)
    {
        DeleteBillRequest request = new DeleteBillRequest();
        request.ID = ID;

        var response = await ServiceBill.DeleteBillAsync(request);
        if (response.Status == true)
        {
            ListaRacuna.Remove(ListaRacuna.Where(b => b.ID == ID).FirstOrDefault());
            ListaRacuna.OrderByDescending(b => b.DatumSlanja); //sortira po desc datumslanja, novi ubaceni su na vrh
            IsMatDialogOpen = false;
            await InvokeAsync(RadzenGrid.Reload);
        }
        else
        {
            IsMatDialogOpen = false;
            snackBarIsOpenDeleted = true;
        }
        StateHasChanged();
    }

    #endregion


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ConvertGRPC ServiceConvert { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private BillsNamespace.BillProtoServis.BillProtoServisClient ServiceBill { get; set; }
    }
}
#pragma warning restore 1591
